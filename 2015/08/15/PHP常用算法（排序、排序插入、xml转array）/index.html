<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>PHP常用算法（排序、排序插入、xml转array） | HK.C</title>
  <meta name="author" content="耳东程">
  
  <meta name="description" content="php, 排序, 排序插入, xml转array">
  
  <meta name="keywords" content="php, 排序, 排序插入, xml转array">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="PHP常用算法（排序、排序插入、xml转array）"/>
  <meta property="og:site_name" content="HK.C"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="HK.C" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">HK.C</a></h1>
  <h2><a href="/">折腾是生命的自然属性</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      
        <img src="">
      
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-08-15T04:27:24.000Z"><a href="/2015/08/15/PHP常用算法（排序、排序插入、xml转array）/">2015-08-15</a></time>
      
      
  
    <h1 class="title">PHP常用算法（排序、排序插入、xml转array）</h1>
  

    </header>
    <div class="entry">
      
        <h2 id="一、排序">一、排序</h2><h4 id="1、二维数组排序"><strong> 1、二维数组排序 </strong></h4><p>主要思路是取出要用来的排序的字段，并以源数组键为建，对其进行相应排序后，对应回源数组。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 二维数组排序（保留键、值）</span><br><span class="line"> *<span class="phpdoc"> @param</span>  $arr       array     排序数组</span><br><span class="line"> *<span class="phpdoc"> @param</span>  $keys      string    排序字段</span><br><span class="line"> *<span class="phpdoc"> @param</span>  $order     int       排序依据 0正序，1逆序</span><br><span class="line"> *<span class="phpdoc"> @return</span> $new_array array     返回排序后数组</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">array_sort</span><span class="params">(<span class="variable">$arr</span>,<span class="variable">$keys</span>,<span class="variable">$order</span>)</span></span>&#123;</span><br><span class="line">    <span class="comment">//判断是否为数组，否则直接返回false</span></span><br><span class="line">    <span class="keyword">if</span>(!is_array(<span class="variable">$arr</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义一个存储排序字段的空数组</span></span><br><span class="line">    <span class="variable">$keysvalue</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="comment">//遍历排序要排序的数组，将要排序的字段取出，形成一个一维数组，键为源数组键，值为排序字段值</span></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$arr</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$val</span>)&#123;</span><br><span class="line">        <span class="variable">$keysvalue</span>[<span class="variable">$key</span>] = <span class="variable">$val</span>[<span class="variable">$keys</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//根据order参数，对上述以为数组排序，注意需采用asort以保留键名</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$order</span> == <span class="number">0</span>)&#123;</span><br><span class="line">        asort(<span class="variable">$keysvalue</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        arsort(<span class="variable">$keysvalue</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将指针重置至第一个</span></span><br><span class="line">    reset(<span class="variable">$keysvalue</span>);</span><br><span class="line">    <span class="comment">//定一个空数组，用以保存排序后的数组</span></span><br><span class="line">    <span class="variable">$new_array</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="comment">//遍历排序后的一维数组，由于其键就是源数组的键，对应其键就可形成一个新数组</span></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$keysort</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$val</span>)&#123;</span><br><span class="line">        <span class="variable">$new_array</span>[<span class="variable">$key</span>] = <span class="variable">$arr</span>[<span class="variable">$key</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//返回排序后的新数组</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$new_array</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2、快速排序"><strong> 2、快速排序 </strong></h4><p>前段时间遇到一个需要根据二位数组的中的多个维度进行排序的情况，于是将快速排序进行了一点改造，以支持多个维度的排序。<br><a id="more"></a><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 快速排序(最多支持三个维度数据，可根据需要添加elseif语句，来扩充维度)</span><br><span class="line"> *<span class="phpdoc"> @param</span>  $arr       array     排序数组 eg:$array = [[300,30,3],[300,40,2],[100,10,1],[100,10,2]];</span><br><span class="line"> *<span class="phpdoc"> @param</span>  $order     int       排序依据 0正序，1逆序</span><br><span class="line"> *<span class="phpdoc"> @return</span> $new_array array     返回排序后数组</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">quickSort</span><span class="params">(<span class="variable">$arr</span>)</span></span>&#123;</span><br><span class="line">    <span class="comment">//判断数组是否需要排序</span></span><br><span class="line">    <span class="keyword">if</span> (count(<span class="variable">$arr</span>) &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$arr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取数组首项作为对比基数</span></span><br><span class="line">    <span class="variable">$key</span> = <span class="variable">$arr</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">//定义左侧空数组</span></span><br><span class="line">    <span class="variable">$left_arr</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="comment">//定义右侧空数组</span></span><br><span class="line">    <span class="variable">$right_arr</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="comment">//对比基数，分别写入左右数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">1</span>; <span class="variable">$i</span> &lt; count(<span class="variable">$arr</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$arr</span>[<span class="variable">$i</span>] &lt; <span class="variable">$key</span>) &#123;</span><br><span class="line">                <span class="variable">$left_arr</span>[] = <span class="variable">$arr</span>[<span class="variable">$i</span>];</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="variable">$arr</span>[<span class="variable">$i</span>][<span class="number">0</span>] &lt; <span class="variable">$key</span>[<span class="number">0</span>]) &#123;</span><br><span class="line">            <span class="variable">$left_arr</span>[] = <span class="variable">$arr</span>[<span class="variable">$i</span>];</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="variable">$arr</span>[<span class="variable">$i</span>] == <span class="variable">$key</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$arr</span>[<span class="variable">$i</span>][<span class="number">1</span>] &lt; <span class="variable">$key</span>[<span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="variable">$left_arr</span>[] = <span class="variable">$arr</span>[<span class="variable">$i</span>];</span><br><span class="line">            &#125; <span class="keyword">elseif</span> (<span class="variable">$arr</span>[<span class="variable">$i</span>][<span class="number">1</span>] == <span class="variable">$key</span>[<span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable">$arr</span>[<span class="variable">$i</span>][<span class="number">2</span>] &lt; <span class="variable">$key</span>[<span class="number">2</span>]) &#123;</span><br><span class="line">                    <span class="variable">$left_arr</span>[] = <span class="variable">$arr</span>[<span class="variable">$i</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$right_arr</span>[] = <span class="variable">$arr</span>[<span class="variable">$i</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//递归调用，对左右数组排序</span></span><br><span class="line">    <span class="variable">$left_arr</span> = quickSort(<span class="variable">$left_arr</span>);</span><br><span class="line">    <span class="variable">$right_arr</span> = quickSort(<span class="variable">$right_arr</span>);</span><br><span class="line">    <span class="comment">//合并并返回排序后的数组</span></span><br><span class="line">    <span class="keyword">return</span> array_merge(<span class="variable">$left_arr</span>,<span class="keyword">array</span>(<span class="variable">$key</span>),<span class="variable">$right_arr</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="二、排序插入">二、排序插入</h2><p>同样是由于业务需要，在二分查找的基础上做了一个排序插入。<br>这个函数分两种情况：<br>一是如果插入的数据已经存在于当前数组，则不会重复插入，而是返回其所在位置。<br>二是如果插入的数据不存在则会将其插入顺序所在位置，并返回整个数组和其插入的位置，例如：向数组<code>[1, 2, 3, 5]</code>中插入<code>4</code>，则会返回<code>[1, 2, 3, 4, 5, &#39;current&#39;=&gt;3]</code>这样的一个数组</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * 排序插入 兼容 二分查找</span><br><span class="line"> *<span class="phpdoc"> @param</span>   $array          array            Y 数组</span><br><span class="line"> *<span class="phpdoc"> @param</span>   $v              string           Y 要找的值</span><br><span class="line"> *<span class="phpdoc"> @param</span>   $low            int              N 查找范围的最小键值</span><br><span class="line"> *<span class="phpdoc"> @param</span>   $high           int              N 范围的最大键值</span><br><span class="line"> *<span class="phpdoc"> @return</span>  $array || $mid  array || int     如果不存在返回插入且已排序数组 || 如果存在返回所在位置</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">binInsert</span><span class="params">(<span class="variable">$array</span>,<span class="variable">$v</span>,<span class="variable">$low</span>=<span class="number">0</span>,<span class="variable">$high</span>=<span class="number">0</span>)</span></span>&#123;</span><br><span class="line">    <span class="comment">//判断是否第一次调用</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$high</span> == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="variable">$high</span> = count(<span class="variable">$array</span>);</span><br><span class="line">        <span class="comment">//排除首项相等</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$array</span>[<span class="number">0</span>] == <span class="variable">$v</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//结束递归并插入</span></span><br><span class="line">    <span class="variable">$diff</span> = <span class="variable">$high</span> - <span class="variable">$low</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$diff</span> == <span class="number">0</span> || <span class="variable">$diff</span> == <span class="number">1</span>)&#123;</span><br><span class="line">        array_splice(<span class="variable">$array</span>, <span class="variable">$low</span>+<span class="number">1</span>, <span class="number">0</span>, <span class="variable">$v</span>);</span><br><span class="line">        <span class="comment">//排除空数组首项</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$diff</span> == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable">$array</span>[<span class="string">'current'</span>] = <span class="variable">$low</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$array</span>[<span class="string">'current'</span>] = <span class="variable">$low</span> + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$array</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果还存在剩余数组元素</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$low</span>&lt;<span class="variable">$high</span>)&#123;</span><br><span class="line">        <span class="comment">//取$low和$high的中间值</span></span><br><span class="line">        <span class="variable">$mid</span> = intval((<span class="variable">$low</span>+<span class="variable">$high</span>)/<span class="number">2</span>);</span><br><span class="line">        <span class="comment">//比对并递归</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$v</span> == <span class="variable">$array</span>[<span class="variable">$mid</span>])&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$mid</span>;</span><br><span class="line">        &#125;<span class="keyword">elseif</span>(<span class="variable">$v</span> &lt; <span class="variable">$array</span>[<span class="variable">$mid</span>])&#123;</span><br><span class="line">            <span class="keyword">return</span> binInsert(<span class="variable">$array</span>, <span class="variable">$v</span>, <span class="variable">$low</span>, <span class="variable">$mid</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> binInsert(<span class="variable">$array</span>, <span class="variable">$v</span>, <span class="variable">$mid</span>, <span class="variable">$high</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="三、xml_转_array">三、xml 转 array</h2><p>同样是在工作中遇到的一个问题，就是从第三方取来一组数据，是xml格式的，处理起来头疼的很，于是将其转换为array，就可以随便处理了。其核心部分就是正则表示式<code>/&lt;(\w+)[^&gt;]*&gt;([\\x00-\\xFF]*?)&lt;\\/\\1&gt;/</code>。解释一下，<code>&lt;(\w+)[^&gt;]*&gt;</code>这一个部分匹配标签头；<code>([\\x00-\\xFF]*?)</code>这一部分匹配标签内部所有内容，并且采用懒惰获取模式，即对后面的匹配模式<code>&lt;\\/\\1&gt;</code>预查后匹配，否则会匹配到所有后面的元素；<code>&lt;\\/\\1&gt;</code>这一部分匹配标签尾。</p>
<p>这其中有两部分匹配获取，及括号内的匹配项，会在下文的匹配结果（debug）中体现出来。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * xml数据转换为array</span><br><span class="line"> *<span class="phpdoc"> @param</span>  $xml          xml      XML格式数据</span><br><span class="line"> *<span class="phpdoc"> @param</span>  $repeatField  string   同级重复标签项</span><br><span class="line"> *<span class="phpdoc"> @return</span> $arr          array    转换后的数组</span><br><span class="line"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xml_to_array</span><span class="params">(<span class="variable">$xml</span>, <span class="variable">$repeatField</span>)</span></span>&#123;</span><br><span class="line">    <span class="comment">//xml数据预处理，去除空白字符</span></span><br><span class="line">    <span class="variable">$regs</span> = <span class="string">"/\s*/"</span>;</span><br><span class="line">    <span class="variable">$xml</span> = preg_replace(<span class="variable">$regs</span>, <span class="string">''</span>, <span class="variable">$xml</span>);</span><br><span class="line">    <span class="comment">//匹配标签及内容</span></span><br><span class="line">    <span class="variable">$reg</span> = <span class="string">"/&lt;(\w+)[^&gt;]*&gt;([\\x00-\\xFF]*?)&lt;\\/\\1&gt;/"</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match_all(<span class="variable">$reg</span>, <span class="variable">$xml</span>, <span class="variable">$matches</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//1、获取匹配后的结果，参考下面的debug</span></span><br><span class="line">        <span class="variable">$count</span> = count(<span class="variable">$matches</span>[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$count</span>; <span class="variable">$i</span>++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$subxml</span>= <span class="variable">$matches</span>[<span class="number">2</span>][<span class="variable">$i</span>];</span><br><span class="line">            <span class="comment">//替换重复的标签项，否则会造成覆盖，如下文的TempTable，像这种重复的键就要用数字来代替</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$matches</span>[<span class="number">1</span>][<span class="variable">$i</span>] == <span class="variable">$repeatField</span>) &#123;</span><br><span class="line">                <span class="variable">$key</span> = <span class="variable">$i</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$key</span> = <span class="variable">$matches</span>[<span class="number">1</span>][<span class="variable">$i</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//判断是否subxml中的数据是否仍为xml数据</span></span><br><span class="line">            <span class="keyword">if</span>(preg_match(<span class="variable">$reg</span>, <span class="variable">$subxml</span>))</span><br><span class="line">            &#123;  <span class="comment">//是，递归</span></span><br><span class="line">                <span class="variable">$arr</span>[<span class="variable">$key</span>] = xml_to_array(<span class="variable">$subxml</span>, <span class="variable">$repeatField</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123; <span class="comment">//否直接写入</span></span><br><span class="line">                <span class="variable">$arr</span>[<span class="variable">$key</span>] = <span class="variable">$subxml</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$arr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong> 调用方法： </strong>xml_to_array($xml, ‘TempTable’)<br><strong> 数据源： </strong>参考如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">NewDataSet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">TempTable</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">nID</span>&gt;</span>2880<span class="tag">&lt;/<span class="title">nID</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">EnterpriseID</span>&gt;</span>8088<span class="tag">&lt;/<span class="title">EnterpriseID</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">EnterNO</span>&gt;</span>100158<span class="tag">&lt;/<span class="title">EnterNO</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">CallID</span>&gt;</span>136****6155201506012258055571<span class="tag">&lt;/<span class="title">CallID</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">CallerID</span>&gt;</span>136****6155<span class="tag">&lt;/<span class="title">CallerID</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">TempTable</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">TempTable</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">nID</span>&gt;</span>2879<span class="tag">&lt;/<span class="title">nID</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">EnterpriseID</span>&gt;</span>8023<span class="tag">&lt;/<span class="title">EnterpriseID</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">EnterNO</span>&gt;</span>101658<span class="tag">&lt;/<span class="title">EnterNO</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">CallID</span>&gt;</span>186****5873201506012012599627<span class="tag">&lt;/<span class="title">CallID</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">CallerID</span>&gt;</span>186****5873<span class="tag">&lt;/<span class="title">CallerID</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">TempTable</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">NewDataSet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">Flag</span>&gt;</span>Ok<span class="tag">&lt;/<span class="title">Flag</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">ReturnMsg</span>&gt;</span>获取呼入记录成功！<span class="tag">&lt;/<span class="title">ReturnMsg</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong> debug 数据</strong></p>
<p><code>array[0]</code>是元数据，<code>array[1]</code>是获取匹配一<code>(\w+)</code>获取的内容，<code>array[2]</code>是获取匹配二<code>([\\x00-\\xFF]*?)</code>获取的内容。</p>
<p>如此一层层递归下去，一层层剥掉她们的外衣！！！</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">array (size=3)</span><br><span class="line">  0 =&gt;</span><br><span class="line">    array (size=3)</span><br><span class="line">      0 =&gt; string '<span class="variable">&lt;NewDataSet&gt;</span></span><br><span class="line">                                <span class="variable">&lt;TempTable&gt;</span></span><br><span class="line">                                    <span class="variable">&lt;nID&gt;</span>2880<span class="variable">&lt;/nID&gt;</span></span><br><span class="line">                                    <span class="variable">&lt;EnterpriseID&gt;</span>8088<span class="variable">&lt;/EnterpriseID&gt;</span></span><br><span class="line">                                    <span class="variable">&lt;EnterNO&gt;</span>100158<span class="variable">&lt;/EnterNO&gt;</span></span><br><span class="line">                                    <span class="variable">&lt;CallID&gt;</span>136<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>6155201506012258055571<span class="variable">&lt;/CallID&gt;</span></span><br><span class="line">                                    <span class="variable">&lt;CallerID&gt;</span>136<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>6155<span class="variable">&lt;/CallerID&gt;</span></span><br><span class="line">                                <span class="variable">&lt;/TempTable&gt;</span></span><br><span class="line">                                <span class="variable">&lt;TempTable&gt;</span></span><br><span class="line">                                    <span class="variable">&lt;nID&gt;</span>2879<span class="variable">&lt;/nID&gt;</span></span><br><span class="line">                                    <span class="variable">&lt;EnterpriseID&gt;</span>8023<span class="variable">&lt;/EnterpriseID&gt;</span></span><br><span class="line">                                    <span class="variable">&lt;EnterNO&gt;</span>101658<span class="variable">&lt;/EnterNO&gt;</span></span><br><span class="line">                                    <span class="variable">&lt;CallID&gt;</span>186<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>5873201506012012599627<span class="variable">&lt;/CallID&gt;</span></span><br><span class="line">                                    <span class="variable">&lt;CallerID&gt;</span>186<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>5873<span class="variable">&lt;/CallerID&gt;</span></span><br><span class="line">                                    <span class="variable">&lt;/TempTable&gt;</span></span><br><span class="line">                                <span class="variable">&lt;/NewDataSet&gt;</span>' (length=373)</span><br><span class="line">      1 =&gt; string '<span class="variable">&lt;Flag&gt;</span>Ok<span class="variable">&lt;/Flag&gt;</span>' (length=15)</span><br><span class="line">      2 =&gt; string '<span class="variable">&lt;ReturnMsg&gt;</span>获取呼入记录成功！<span class="variable">&lt;/ReturnMsg&gt;</span>' (length=50)</span><br><span class="line">  1 =&gt;</span><br><span class="line">    array (size=3)</span><br><span class="line">      0 =&gt; string 'NewDataSet' (length=10)</span><br><span class="line">      1 =&gt; string 'Flag' (length=4)</span><br><span class="line">      2 =&gt; string 'ReturnMsg' (length=9)</span><br><span class="line">  2 =&gt;</span><br><span class="line">    array (size=3)</span><br><span class="line">      0 =&gt; string '<span class="variable">&lt;TempTable&gt;</span></span><br><span class="line">                                <span class="variable">&lt;nID&gt;</span>2880<span class="variable">&lt;/nID&gt;</span></span><br><span class="line">                                <span class="variable">&lt;EnterpriseID&gt;</span>8088<span class="variable">&lt;/EnterpriseID&gt;</span></span><br><span class="line">                                <span class="variable">&lt;EnterNO&gt;</span>100158<span class="variable">&lt;/EnterNO&gt;</span></span><br><span class="line">                                <span class="variable">&lt;CallID&gt;</span>136<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>6155201506012258055571<span class="variable">&lt;/CallID&gt;</span></span><br><span class="line">                                <span class="variable">&lt;CallerID&gt;</span>136<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>6155<span class="variable">&lt;/CallerID&gt;</span></span><br><span class="line">                            <span class="variable">&lt;/TempTable&gt;</span></span><br><span class="line">                            <span class="variable">&lt;TempTable&gt;</span></span><br><span class="line">                                <span class="variable">&lt;nID&gt;</span>2879<span class="variable">&lt;/nID&gt;</span></span><br><span class="line">                                <span class="variable">&lt;EnterpriseID&gt;</span>8023<span class="variable">&lt;/EnterpriseID&gt;</span></span><br><span class="line">                                <span class="variable">&lt;EnterNO&gt;</span>101658<span class="variable">&lt;/EnterNO&gt;</span></span><br><span class="line">                                <span class="variable">&lt;CallID&gt;</span>186<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>5873201506012012599627<span class="variable">&lt;/CallID&gt;</span></span><br><span class="line">                                <span class="variable">&lt;CallerID&gt;</span>186<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>5873<span class="variable">&lt;/CallerID&gt;</span></span><br><span class="line">                            <span class="variable">&lt;/TempTable&gt;</span>' (length=348)</span><br><span class="line">      1 =&gt; string 'Ok' (length=2)</span><br><span class="line">      2 =&gt; string '获取呼入记录成功！' (length=27)</span><br></pre></td></tr></table></figure>
<p><strong> 最终结果 </strong></p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">array (size=<span class="number">3</span>)</span><br><span class="line">  <span class="string">'NewDataSet'</span> =&gt;</span><br><span class="line">    array (size=<span class="number">2</span>)</span><br><span class="line">      <span class="number">0</span> =&gt;</span><br><span class="line">        array (size=<span class="number">5</span>)</span><br><span class="line">          <span class="string">'nID'</span> =&gt; <span class="keyword">string</span> <span class="string">'2880'</span> (<span class="built_in">length</span>=<span class="number">4</span>)</span><br><span class="line">          <span class="string">'EnterpriseID'</span> =&gt; <span class="keyword">string</span> <span class="string">'8088'</span> (<span class="built_in">length</span>=<span class="number">4</span>)</span><br><span class="line">          <span class="string">'EnterNO'</span> =&gt; <span class="keyword">string</span> <span class="string">'100158'</span> (<span class="built_in">length</span>=<span class="number">6</span>)</span><br><span class="line">          <span class="string">'CallID'</span> =&gt; <span class="keyword">string</span> <span class="string">'136****6155201506012258055571'</span> (<span class="built_in">length</span>=<span class="number">29</span>)</span><br><span class="line">          <span class="string">'CallerID'</span> =&gt; <span class="keyword">string</span> <span class="string">'136****6155'</span> (<span class="built_in">length</span>=<span class="number">11</span>)</span><br><span class="line">      <span class="number">1</span> =&gt;</span><br><span class="line">        array (size=<span class="number">5</span>)</span><br><span class="line">          <span class="string">'nID'</span> =&gt; <span class="keyword">string</span> <span class="string">'2879'</span> (<span class="built_in">length</span>=<span class="number">4</span>)</span><br><span class="line">          <span class="string">'EnterpriseID'</span> =&gt; <span class="keyword">string</span> <span class="string">'8023'</span> (<span class="built_in">length</span>=<span class="number">4</span>)</span><br><span class="line">          <span class="string">'EnterNO'</span> =&gt; <span class="keyword">string</span> <span class="string">'101658'</span> (<span class="built_in">length</span>=<span class="number">6</span>)</span><br><span class="line">          <span class="string">'CallID'</span> =&gt; <span class="keyword">string</span> <span class="string">'186****5873201506012012599627'</span> (<span class="built_in">length</span>=<span class="number">29</span>)</span><br><span class="line">          <span class="string">'CallerID'</span> =&gt; <span class="keyword">string</span> <span class="string">'186****5873'</span> (<span class="built_in">length</span>=<span class="number">11</span>)</span><br><span class="line">  <span class="string">'Flag'</span> =&gt; <span class="keyword">string</span> <span class="string">'Ok'</span> (<span class="built_in">length</span>=<span class="number">2</span>)</span><br><span class="line">  <span class="string">'ReturnMsg'</span> =&gt; <span class="keyword">string</span> <span class="string">'获取呼入记录成功！'</span> (<span class="built_in">length</span>=<span class="number">27</span>)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/php/">php</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/php/">php</a>, <a href="/tags/xml转array/">xml转array</a>, <a href="/tags/排序/">排序</a>, <a href="/tags/排序插入/">排序插入</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>

  
      <div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=123456789012345";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<div class="fb-comments" data-href="http://yoursite.com/2015/08/15/PHP常用算法（排序、排序插入、xml转array）/index.html" data-num-posts="5" data-width="760" data-colorscheme="light"></div>
      
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/VPN/">VPN</a><small>1</small></li>
  
    <li><a href="/categories/mysql/">mysql</a><small>2</small></li>
  
    <li><a href="/categories/php/">php</a><small>4</small></li>
  
    <li><a href="/categories/php7/">php7</a><small>1</small></li>
  
    <li><a href="/categories/python/">python</a><small>1</small></li>
  
    <li><a href="/categories/redis/">redis</a><small>2</small></li>
  
    <li><a href="/categories/rust/">rust</a><small>1</small></li>
  
    <li><a href="/categories/yaf/">yaf</a><small>1</small></li>
  
    <li><a href="/categories/yii2/">yii2</a><small>4</small></li>
  
    <li><a href="/categories/随笔/">随笔</a><small>2</small></li>
  
  </ul>
</div>


  

  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2015/11/19/rust/">rust</a>
      </li>
    
      <li>
        <a href="/2015/11/18/yaf/">yaf</a>
      </li>
    
      <li>
        <a href="/2015/08/27/yii2过滤器：Filters/">yii2过滤器：Filters</a>
      </li>
    
      <li>
        <a href="/2015/08/26/yii2独立模块：Modules/">yii2独立模块：Modules</a>
      </li>
    
      <li>
        <a href="/2015/08/15/PHP获取上周的起始时间和结束时间/">小技巧-PHP获取上周的起始时间和结束时间</a>
      </li>
    
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/MVC/" style="font-size: 10px;">MVC</a><a href="/tags/MarkDown/" style="font-size: 10px;">MarkDown</a><a href="/tags/ROUTE/" style="font-size: 10px;">ROUTE</a><a href="/tags/SSH/" style="font-size: 10px;">SSH</a><a href="/tags/VPN/" style="font-size: 10px;">VPN</a><a href="/tags/curl/" style="font-size: 10px;">curl</a><a href="/tags/mysql/" style="font-size: 10px;">mysql</a><a href="/tags/php/" style="font-size: 20px;">php</a><a href="/tags/redis/" style="font-size: 10px;">redis</a><a href="/tags/xml转array/" style="font-size: 10px;">xml转array</a><a href="/tags/yii2/" style="font-size: 15px;">yii2</a><a href="/tags/排序/" style="font-size: 10px;">排序</a><a href="/tags/排序插入/" style="font-size: 10px;">排序插入</a><a href="/tags/独立模块/" style="font-size: 10px;">独立模块</a><a href="/tags/辞赋/" style="font-size: 10px;">辞赋</a>
  </div>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 耳东程
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>